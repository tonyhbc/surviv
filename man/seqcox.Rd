% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/seqcox.R
\name{seqcox}
\alias{seqcox}
\title{Sequential Cox analysis via sequential trial emulation (with IPACW)}
\usage{
seqcox(
  formula,
  data,
  id,
  trial_id = "trial",
  stratify = TRUE,
  se_type = c("jackknife", "bootstrap", "robust", "none"),
  B = 200,
  seed = NULL,
  ipcw = TRUE,
  ipcw_trunc = 0.95,
  ipcw_den_covs = NULL,
  ipcw_num_covs = NULL,
  weight_var = NULL,
  by_trial = FALSE,
  ...
)
}
\arguments{
\item{formula}{Survival formula, e.g.
\code{Surv(start.new, stop.new, event) ~ A.base + L1.base + L2.base},
where:
\itemize{
\item the first term ending in \code{.base} is treated as the baseline
treatment, and
\item remaining \code{.base} terms are baseline covariates used in the
IPACW numerator model by default.
}}

\item{data}{A \code{seqem} object returned by \code{\link[=seqem]{seqem()}}. It must contain both
\code{data_seqorig} (pre-censoring stacked trials) and \code{data_seqem} (post-
censoring stacked trials), as constructed in the current implementation.}

\item{id}{Name of the subject identifier.}

\item{trial_id}{Name of the trial identifier (default \code{"trial"}).}

\item{stratify}{Logical; if \code{TRUE} (default), adds \code{strata(trial_id)} to the
Cox model so each emulated trial has its own baseline hazard.}

\item{se_type}{Type of standard error: \code{"jackknife"}, \code{"bootstrap"},
\code{"robust"}, or \code{"none"}.}

\item{B}{Number of bootstrap replicates if \code{se_type = "bootstrap"}.}

\item{seed}{Optional random seed for bootstrap.}

\item{ipcw}{Logical; if \code{TRUE} (default), estimate stabilized IPACW using
Keogh-style logistic models. If \code{FALSE}, no IPACW is estimated unless
\code{weight_var} is supplied.}

\item{ipcw_trunc}{Quantile at which to truncate cumulative IPACW
(default \code{0.95}). Set to \code{NULL} to disable truncation.}

\item{ipcw_den_covs}{Optional character vector of \strong{time-varying} covariate
names whose lead values (e.g. \code{L.lead1}) should be used in the denominator
model. If \code{NULL}, the underlying versions of \code{.base} covariates from
\code{formula} are used (e.g. from \code{L.base} we use \code{L.lead1}).}

\item{ipcw_num_covs}{Optional character vector of \strong{baseline} \code{.base}
covariates to use in the numerator model. If \code{NULL}, all \code{.base} covariates
except the baseline treatment are used.}

\item{weight_var}{Optional name of a weight column already in the stacked
data to use in the Cox fit. If supplied, no IPACW is estimated.}

\item{...}{Additional arguments passed to \code{\link[survival:coxph]{survival::coxph()}}.}
}
\value{
An object of class \code{"seqcox"} with components:
\itemize{
\item \code{call} – the matched call.
\item \code{formula} – formula used in the main Cox fit (including strata).
\item \code{coef}, \code{var}, \code{se}, \code{z}, \code{p}, \code{ci} – point estimates and Wald
inference for the Cox coefficients.
\item \code{n}, \code{nevent} – number of observations and events in the main fit.
\item \code{fit} – the \code{\link[survival:coxph]{survival::coxph()}} object from the main fit (possibly
with robust variance if \code{se_type = "robust"}).
\item \code{weights_name} – name of the weight column used in the Cox model.
\item \code{se_type}, \code{B}, \code{jackknife}, \code{bootstrap} – information about the
resampling SEs if requested.
\item \code{ipcw} – logical; whether IPACW was estimated inside \code{seqcox()}.
}
}
\description{
Fit a Cox proportional hazards model to sequential trials data created by
\code{\link[=seqem]{seqem()}}, using stabilized inverse probability of artificial censoring
weights (IPACW) in the style of Gran et al. and Keogh et al.
}
