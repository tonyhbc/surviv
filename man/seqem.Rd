% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/seqem.R
\name{seqem}
\alias{seqem}
\title{Sequential trial emulation for time-dependent treatment data}
\usage{
seqem(
  data,
  start,
  stop,
  event,
  tvtrt,
  id,
  covs = NULL,
  coarsen = c("none", "floor", "ceiling"),
  cbin_width = NULL
)
}
\arguments{
\item{data}{A \code{data.frame} in counting-process form with potentially
multiple rows per individual.}

\item{start}{Name of the start time variable.}

\item{stop}{Name of the stop time variable.}

\item{event}{Name of the event indicator (0/1).}

\item{tvtrt}{Name of the time-varying treatment variable (binary 0/1).}

\item{id}{Name of the individual identifier.}

\item{covs}{Optional character vector of covariate names in \code{data} for which
trial-specific baseline versions should be created. For each \code{v} in
\code{covs}, \code{seqem()} creates \code{v.base} representing the value of \code{v} at
the start of each emulated trial for each individual. A baseline version
of \code{tvtrt} is always created as \code{tvtrt.base}.}
}
\value{
An object of class \code{"seqem"} with components:
\itemize{
\item \code{data_seqorig} – stacked emulated trials \strong{before} artificial
censoring, with columns:
\code{id}, \code{trial}, \code{trial_time}, \code{rownum}, \code{visit},
original \code{start}, \code{stop}, \code{event}, \code{tvtrt}, covariates,
\code{start.new}, \code{stop.new}, \code{tvtrt.base}, and \verb{\{cov\}.base} for
covariates in \code{covs}.
\item \code{data_seqem} – stacked emulated trials \strong{after} artificial
censoring, obtained by restricting to rows with
\code{tvtrt == tvtrt.base}. This is the dataset typically used for
sequential Cox / MSM fitting with IPACW.
\item \code{summary} – a character string describing the STE object (used by
\code{print.seqem()}).
\item \code{trial_summary} – a per-trial summary \code{data.frame} with one row
per emulated trial and columns:
\code{trial} (trial index), \code{t0} (trial start time),
\code{n} (unique individuals), \code{rows} (person-time rows),
\code{treated} (unique baseline-treated individuals),
and \code{events} (terminal events) in that trial.
}

Attributes on \code{data_seqorig} and \code{data_seqem}:
\itemize{
\item \code{"trial_times"} – vector of trial start times.
\item \code{"id_var"}, \code{"start_var"}, \code{"stop_var"}, \code{"event_var"},
\code{"tvtrt_var"} – names of the corresponding variables.
}
}
\description{
Construct a stacked "sequence of trials" dataset from longitudinal
survival data in counting-process form, following the sequential
trials emulation framework of Gran et al. and Keogh et al.

The function:
\enumerate{
\item Identifies trial start times: the earliest cohort start time plus
all times at which any individual initiates treatment (0 -> 1).
\item Augments each individual's trajectory by splitting intervals at
these trial start times so that each at-risk subject has an
explicit row starting at each trial time.
\item For each trial, includes individuals who are under observation at
the trial start and have not yet started treatment, and constructs
trial-specific baseline versions of treatment and covariates
(suffix \code{.base}), new follow-up times \code{start.new}, \code{stop.new}, and
row index \code{rownum} within \verb{(id, trial)}.
\item Implements artificial censoring by restricting to rows where the
current treatment equals the baseline treatment in that trial.
}
}
